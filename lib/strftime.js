'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _dateNames = require('date-names');

var _dateNames2 = _interopRequireDefault(_dateNames);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function strftime(date, format, names) {
  var timestamp = date.getTime();

  names = names || _dateNames2.default;

  return format.replace(/%([-_0]?.)/g, function (_, c) {
    var padding = null;

    if (c.length == 2) {
      switch (c[0]) {
        case '-':
          padding = '';break;
        case '_':
          padding = ' ';break;
        case '0':
          padding = '0';break;
        default:
          return _; // should never reach this one
      }

      c = c[1];
    }

    switch (c) {
      case 'A':
        return names.days[date.getDay()];
      case 'a':
        return names.abbreviated_days[date.getDay()];
      case 'B':
        return names.months[date.getMonth()];
      case 'b':
        return names.abbreviated_months[date.getMonth()];
      case 'C':
        return pad(Math.floor(date.getFullYear() / 100), padding);
      case 'D':
        return strftime(date, '%m/%d/%y');
      case 'd':
        return pad(date.getDate(), padding);
      case 'e':
        return date.getDate();
      case 'F':
        return strftime(date, '%Y-%m-%d');
      case 'H':
        return pad(date.getHours(), padding);
      case 'h':
        return names.abbreviated_months[date.getMonth()];
      case 'I':
        return pad(hours12(date), padding);
      case 'j':
        return pad(Math.ceil((date.getTime() - new Date(date.getFullYear(), 0, 1).getTime()) / (1000 * 60 * 60 * 24)), 3);
      case 'k':
        return pad(date.getHours(), padding === null ? ' ' : padding);
      case 'L':
        return pad(Math.floor(timestamp % 1000), 3);
      case 'l':
        return pad(hours12(date), padding === null ? ' ' : padding);
      case 'M':
        return pad(date.getMinutes(), padding);
      case 'm':
        return pad(date.getMonth() + 1, padding);
      case 'n':
        return '\n';
      case 'o':
        return String(date.getDate()) + ordinal(date.getDate());
      case 'P':
        return date.getHours() < 12 ? names.am.toLowerCase() : names.pm.toLowerCase();
      case 'p':
        return date.getHours() < 12 ? names.am.toUpperCase() : names.pm.toUpperCase();
      case 'R':
        return strftime(date, '%H:%M');
      case 'r':
        return strftime(date, '%I:%M:%S %p');
      case 'S':
        return pad(date.getSeconds(), padding);
      case 's':
        return Math.floor(timestamp / 1000);
      case 'T':
        return strftime(date, '%H:%M:%S');
      case 't':
        return '\t';
      case 'U':
        return pad(weekNumber(date, 'sunday'), padding);
      case 'u':
        return date.getDay() === 0 ? 7 : date.getDay();
      case 'v':
        return strftime(date, '%e-%b-%Y');
      case 'W':
        return pad(weekNumber(date, 'monday'), padding);
      case 'w':
        return date.getDay();
      case 'Y':
        return date.getFullYear();
      case 'y':
        var y = String(date.getFullYear());return y.slice(y.length - 2);
      case 'Z':
        var tzString = date.toString().match(/\((\w+)\)/);return tzString && tzString[1] || '';
      case 'z':
        var off = date.getTimezoneOffset();return (off > 0 ? '-' : '+') + pad(Math.round(Math.abs(off / 60)), 2) + ':' + pad(off % 60, 2);
      default:
        return c;
    }
  });
}

function pad(n, padding, length) {
  if (typeof padding === 'number') {
    length = padding;
    padding = '0';
  }

  if (padding === null) {
    padding = '0';
  }

  length = length || 2;

  var s = String(n);

  if (padding) {
    while (s.length < length) {
      s = padding + s;
    }
  }

  return s;
}

function hours12(date) {
  var hour = date.getHours();

  if (hour === 0) {
    hour = 12;
  } else if (hour > 12) {
    hour -= 12;
  }

  return hour;
}

function ordinal(n) {
  var i = n % 10;
  var ii = n % 100;

  if (ii >= 11 && ii <= 13 || i === 0 || i >= 4) {
    return 'th';
  }

  switch (i) {
    case 1:
      return 'st';
    case 2:
      return 'nd';
    case 3:
      return 'rd';
  }
}

function weekNumber(date) {
  var firstWeekday = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'sunday';

  var wday = date.getDay();

  if (firstWeekday == 'monday') {
    if (wday === 0) {
      // Sunday
      wday = 6;
    } else {
      wday--;
    }
  }

  var firstDayOfYear = new Date(date.getFullYear(), 0, 1);
  var yday = (date - firstDayOfYear) / 86400000;
  var weekNum = (yday + 7 - wday) / 7;

  return Math.floor(weekNum);
}

exports.default = strftime;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zdHJmdGltZS5qcyJdLCJuYW1lcyI6WyJzdHJmdGltZSIsImRhdGUiLCJmb3JtYXQiLCJuYW1lcyIsInRpbWVzdGFtcCIsImdldFRpbWUiLCJyZXBsYWNlIiwiXyIsImMiLCJwYWRkaW5nIiwibGVuZ3RoIiwiZGF5cyIsImdldERheSIsImFiYnJldmlhdGVkX2RheXMiLCJtb250aHMiLCJnZXRNb250aCIsImFiYnJldmlhdGVkX21vbnRocyIsInBhZCIsIk1hdGgiLCJmbG9vciIsImdldEZ1bGxZZWFyIiwiZ2V0RGF0ZSIsImdldEhvdXJzIiwiaG91cnMxMiIsImNlaWwiLCJEYXRlIiwiZ2V0TWludXRlcyIsIlN0cmluZyIsIm9yZGluYWwiLCJhbSIsInRvTG93ZXJDYXNlIiwicG0iLCJ0b1VwcGVyQ2FzZSIsImdldFNlY29uZHMiLCJ3ZWVrTnVtYmVyIiwieSIsInNsaWNlIiwidHpTdHJpbmciLCJ0b1N0cmluZyIsIm1hdGNoIiwib2ZmIiwiZ2V0VGltZXpvbmVPZmZzZXQiLCJyb3VuZCIsImFicyIsIm4iLCJzIiwiaG91ciIsImkiLCJpaSIsImZpcnN0V2Vla2RheSIsIndkYXkiLCJmaXJzdERheU9mWWVhciIsInlkYXkiLCJ3ZWVrTnVtIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7Ozs7O0FBRUEsU0FBU0EsUUFBVCxDQUFrQkMsSUFBbEIsRUFBd0JDLE1BQXhCLEVBQWdDQyxLQUFoQyxFQUF1QztBQUNyQyxNQUFNQyxZQUFZSCxLQUFLSSxPQUFMLEVBQWxCOztBQUVBRixVQUFRQSw0QkFBUjs7QUFFQSxTQUFPRCxPQUFPSSxPQUFQLENBQWUsYUFBZixFQUE4QixVQUFDQyxDQUFELEVBQUlDLENBQUosRUFBVTtBQUM3QyxRQUFJQyxVQUFVLElBQWQ7O0FBRUEsUUFBSUQsRUFBRUUsTUFBRixJQUFZLENBQWhCLEVBQW1CO0FBQ2pCLGNBQVFGLEVBQUUsQ0FBRixDQUFSO0FBQ0UsYUFBSyxHQUFMO0FBQVVDLG9CQUFVLEVBQVYsQ0FBZTtB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QUFYLENBQVA7QUFDRDs7a0JBRWNyRCxRIiwiZmlsZSI6InN0cmZ0aW1lLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGRhdGVOYW1lcyBmcm9tICdkYXRlLW5hbWVzJztcclxuXHJcbmZ1bmN0aW9uIHN0cmZ0aW1lKGRhdGUsIGZvcm1hdCwgbmFtZXMpIHtcclxuICBjb25zdCB0aW1lc3RhbXAgPSBkYXRlLmdldFRpbWUoKTtcclxuXHJcbiAgbmFtZXMgPSBuYW1lcyB8fCBkYXRlTmFtZXM7XHJcblxyXG4gIHJldHVybiBmb3JtYXQucmVwbGFjZSgvJShbLV8wXT8uKS9nLCAoXywgYykgPT4ge1xyXG4gICAgbGV0IHBhZGRpbmcgPSBudWxsO1xyXG5cclxuICAgIGlmIChjLmxlbmd0aCA9PSAyKSB7XHJcbiAgICAgIHN3aXRjaCAoY1swXSkge1xyXG4gICAgICAgIGNhc2UgJy0nOiBwYWRkaW5nID0gJyc7ICBicmVhaztcclxuICAgICAgICBjYXNlICdfJzogcGFkZGluZyA9ICcgJzsgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnMCc6IHBhZGRpbmcgPSAnMCc7IGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6IHJldHVybiBfOyAvLyBzaG91bGQgbmV2ZXIgcmVhY2ggdGhpcyBvbmVcclxuICAgICAgfVxyXG5cclxuICAgICAgYyA9IGNbMV07XHJcbiAgICB9XHJcblxyXG4gICAgc3dpdGNoIChjKSB7XHJcbiAgICAgIGNhc2UgJ0EnOiByZXR1cm4gbmFtZXMuZGF5c1tkYXRlLmdldERheSgpXTtcclxuICAgICAgY2FzZSAnYSc6IHJldHVybiBuYW1lcy5hYmJyZXZpYXRlZF9kYXlzW2RhdGUuZ2V0RGF5KCldO1xyXG4gICAgICBjYXNlICdCJzogcmV0dXJuIG5hbWVzLm1vbnRoc1tkYXRlLmdldE1vbnRoKCldO1xyXG4gICAgICBjYXNlICdiJzogcmV0dXJuIG5hbWVzLmFiYnJldmlhdGVkX21vbnRoc1tkYXRlLmdldE1vbnRoKCldO1xyXG4gICAgICBjYXNlICdDJzogcmV0dXJuIHBhZChNYXRoLmZsb29yKGRhdGUuZ2V0RnVsbFllYXIoKSAvIDEwMCksIHBhZGRpbmcpO1xyXG4gICAgICBjYXNlICdEJzogcmV0dXJuIHN0cmZ0aW1lKGRhdGUsICclbS8lZC8leScpO1xyXG4gICAgICBjYXNlICdkJzogcmV0dXJuIHBhZChkYXRlLmdldERhdGUoKSwgcGFkZGluZyk7XHJcbiAgICAgIGNhc2UgJ2UnOiByZXR1cm4gZGF0ZS5nZXREYXRlKCk7XHJcbiAgICAgIGNhc2UgJ0YnOiByZXR1cm4gc3RyZnRpbWUoZGF0ZSwgJyVZLSVtLSVkJyk7XHJcbiAgICAgIGNhc2UgJ0gnOiByZXR1cm4gcGFkKGRhdGUuZ2V0SG91cnMoKSwgcGFkZGluZyk7XHJcbiAgICAgIGNhc2UgJ2gnOiByZXR1cm4gbmFtZXMuYWJicmV2aWF0ZWRfbW9udGhzW2RhdGUuZ2V0TW9udGgoKV07XHJcbiAgICAgIGNhc2UgJ0knOiByZXR1cm4gcGFkKGhvdXJzMTIoZGF0ZSksIHBhZGRpbmcpO1xyXG4gICAgICBjYXNlICdqJzogcmV0dXJuIHBhZChNYXRoLmNlaWwoKGRhdGUuZ2V0VGltZSgpIC0gKG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgMCwgMSkpLmdldFRpbWUoKSkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpLCAzKTtcclxuICAgICAgY2FzZSAnayc6IHJldHVybiBwYWQoZGF0ZS5nZXRIb3VycygpLCBwYWRkaW5nID09PSBudWxsID8gJyAnIDogcGFkZGluZyk7XHJcbiAgICAgIGNhc2UgJ0wnOiByZXR1cm4gcGFkKE1hdGguZmxvb3IodGltZXN0YW1wICUgMTAwMCksIDMpO1xyXG4gICAgICBjYXNlICdsJzogcmV0dXJuIHBhZChob3VyczEyKGRhdGUpLCBwYWRkaW5nID09PSBudWxsID8gJyAnIDogcGFkZGluZyk7XHJcbiAgICAgIGNhc2UgJ00nOiByZXR1cm4gcGFkKGRhdGUuZ2V0TWludXRlcygpLCBwYWRkaW5nKTtcclxuICAgICAgY2FzZSAnbSc6IHJldHVybiBwYWQoZGF0ZS5nZXRNb250aCgpICsgMSwgcGFkZGluZyk7XHJcbiAgICAgIGNhc2UgJ24nOiByZXR1cm4gJ1xcbic7XHJcbiAgICAgIGNhc2UgJ28nOiByZXR1cm4gU3RyaW5nKGRhdGUuZ2V0RGF0ZSgpKSArIG9yZGluYWwoZGF0ZS5nZXREYXRlKCkpO1xyXG4gICAgICBjYXNlICdQJzogcmV0dXJuIGRhdGUuZ2V0SG91cnMoKSA8IDEyID8gbmFtZXMuYW0udG9Mb3dlckNhc2UoKSA6IG5hbWVzLnBtLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGNhc2UgJ3AnOiByZXR1cm4gZGF0ZS5nZXRIb3VycygpIDwgMTIgPyBuYW1lcy5hbS50b1VwcGVyQ2FzZSgpIDogbmFtZXMucG0udG9VcHBlckNhc2UoKTtcclxuICAgICAgY2FzZSAnUic6IHJldHVybiBzdHJmdGltZShkYXRlLCAnJUg6JU0nKTtcclxuICAgICAgY2FzZSAncic6IHJldHVybiBzdHJmdGltZShkYXRlLCAnJUk6JU06JVMgJXAnKTtcclxuICAgICAgY2FzZSAnUyc6IHJldHVybiBwYWQoZGF0ZS5nZXRTZWNvbmRzKCksIHBhZGRpbmcpO1xyXG4gICAgICBjYXNlICdzJzogcmV0dXJuIE1hdGguZmxvb3IodGltZXN0YW1wIC8gMTAwMCk7XHJcbiAgICAgIGNhc2UgJ1QnOiByZXR1cm4gc3RyZnRpbWUoZGF0ZSwgJyVIOiVNOiVTJyk7XHJcbiAgICAgIGNhc2UgJ3QnOiByZXR1cm4gJ1xcdCc7XHJcbiAgICAgIGNhc2UgJ1UnOiByZXR1cm4gcGFkKHdlZWtOdW1iZXIoZGF0ZSwgJ3N1bmRheScpLCBwYWRkaW5nKTtcclxuICAgICAgY2FzZSAndSc6IHJldHVybiBkYXRlLmdldERheSgpID09PSAwID8gNyA6IGRhdGUuZ2V0RGF5KCk7XHJcbiAgICAgIGNhc2UgJ3YnOiByZXR1cm4gc3RyZnRpbWUoZGF0ZSwgJyVlLSViLSVZJyk7XHJcbiAgICAgIGNhc2UgJ1cnOiByZXR1cm4gcGFkKHdlZWtOdW1iZXIoZGF0ZSwgJ21vbmRheScpLCBwYWRkaW5nKTtcclxuICAgICAgY2FzZSAndyc6IHJldHVybiBkYXRlLmdldERheSgpO1xyXG4gICAgICBjYXNlICdZJzogcmV0dXJuIGRhdGUuZ2V0RnVsbFllYXIoKTtcclxuICAgICAgY2FzZSAneSc6IGNvbnN0IHkgPSBTdHJpbmcoZGF0ZS5nZXRGdWxsWWVhcigpKTsgcmV0dXJuIHkuc2xpY2UoeS5sZW5ndGggLSAyKTtcclxuICAgICAgY2FzZSAnWic6IGNvbnN0IHR6U3RyaW5nID0gZGF0ZS50b1N0cmluZygpLm1hdGNoKC9cXCgoXFx3KylcXCkvKTsgcmV0dXJuIHR6U3RyaW5nICYmIHR6U3RyaW5nWzFdIHx8ICcnO1xyXG4gICAgICBjYXNlICd6JzogY29uc3Qgb2ZmID0gZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpOyByZXR1cm4gYCR7KG9mZiA+IDAgPyAnLScgOiAnKycpICsgcGFkKE1hdGgucm91bmQoTWF0aC5hYnMob2ZmIC8gNjApKSwgMil9OiR7cGFkKG9mZiAlIDYwLCAyKX1gO1xyXG4gICAgICBkZWZhdWx0OiByZXR1cm4gYztcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gcGFkKG4sIHBhZGRpbmcsIGxlbmd0aCkge1xyXG4gIGlmICh0eXBlb2YgcGFkZGluZyA9PT0gJ251bWJlcicpIHtcclxuICAgIGxlbmd0aCA9IHBhZGRpbmc7XHJcbiAgICBwYWRkaW5nID0gJzAnO1xyXG4gIH1cclxuXHJcbiAgaWYgKHBhZGRpbmcgPT09IG51bGwpIHtcclxuICAgIHBhZGRpbmcgPSAnMCc7XHJcbiAgfVxyXG5cclxuICBsZW5ndGggPSBsZW5ndGggfHwgMjtcclxuXHJcbiAgbGV0IHMgPSBTdHJpbmcobik7XHJcblxyXG4gIGlmIChwYWRkaW5nKSB7XHJcbiAgICB3aGlsZSAocy5sZW5ndGggPCBsZW5ndGgpIHtcclxuICAgICAgcyA9IHBhZGRpbmcgKyBzO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhvdXJzMTIoZGF0ZSkge1xyXG4gIGxldCBob3VyID0gZGF0ZS5nZXRIb3VycygpO1xyXG5cclxuICBpZiAoaG91ciA9PT0gMCkge1xyXG4gICAgaG91ciA9IDEyO1xyXG4gIH0gZWxzZSBpZiAoaG91ciA+IDEyKSB7XHJcbiAgICBob3VyIC09IDEyO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGhvdXI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9yZGluYWwobikge1xyXG4gIGNvbnN0IGkgPSBuICUgMTA7XHJcbiAgY29uc3QgaWkgPSBuICUgMTAwO1xyXG5cclxuICBpZiAoKGlpID49IDExICYmIGlpIDw9IDEzKSB8fCBpID09PSAwIHx8IGkgPj0gNCkge1xyXG4gICAgcmV0dXJuICd0aCc7XHJcbiAgfVxyXG5cclxuICBzd2l0Y2ggKGkpIHtcclxuICAgIGNhc2UgMTogcmV0dXJuICdzdCc7XHJcbiAgICBjYXNlIDI6IHJldHVybiAnbmQnO1xyXG4gICAgY2FzZSAzOiByZXR1cm4gJ3JkJztcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHdlZWtOdW1iZXIoZGF0ZSwgZmlyc3RXZWVrZGF5PSdzdW5kYXknKSB7XHJcbiAgbGV0IHdkYXkgPSBkYXRlLmdldERheSgpO1xyXG5cclxuICBpZiAoZmlyc3RXZWVrZGF5ID09ICdtb25kYXknKSB7XHJcbiAgICBpZiAod2RheSA9PT0gMCkgeyAvLyBTdW5kYXlcclxuICAgICAgd2RheSA9IDY7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB3ZGF5LS07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb25zdCBmaXJzdERheU9mWWVhciA9IG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgMCwgMSk7XHJcbiAgY29uc3QgeWRheSA9IChkYXRlIC0gZmlyc3REYXlPZlllYXIpIC8gODY0MDAwMDA7XHJcbiAgY29uc3Qgd2Vla051bSA9ICh5ZGF5ICsgNyAtIHdkYXkpIC8gNztcclxuXHJcbiAgcmV0dXJuIE1hdGguZmxvb3Iod2Vla051bSk7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHN0cmZ0aW1lO1xyXG4iXX0=