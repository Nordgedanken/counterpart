'use strict';

var dateNames = require('date-names');

function strftime(date, format, names) {
  var timestamp = date.getTime();

  names = names || dateNames;

  return format.replace(/%([-_0]?.)/g, function (_, c) {
    var padding = null;

    if (c.length == 2) {
      switch (c[0]) {
        case '-':
          padding = '';break;
        case '_':
          padding = ' ';break;
        case '0':
          padding = '0';break;
        default:
          return _; // should never reach this one
      }

      c = c[1];
    }

    switch (c) {
      case 'A':
        return names.days[date.getDay()];
      case 'a':
        return names.abbreviated_days[date.getDay()];
      case 'B':
        return names.months[date.getMonth()];
      case 'b':
        return names.abbreviated_months[date.getMonth()];
      case 'C':
        return pad(Math.floor(date.getFullYear() / 100), padding);
      case 'D':
        return strftime(date, '%m/%d/%y');
      case 'd':
        return pad(date.getDate(), padding);
      case 'e':
        return date.getDate();
      case 'F':
        return strftime(date, '%Y-%m-%d');
      case 'H':
        return pad(date.getHours(), padding);
      case 'h':
        return names.abbreviated_months[date.getMonth()];
      case 'I':
        return pad(hours12(date), padding);
      case 'j':
        return pad(Math.ceil((date.getTime() - new Date(date.getFullYear(), 0, 1).getTime()) / (1000 * 60 * 60 * 24)), 3);
      case 'k':
        return pad(date.getHours(), padding === null ? ' ' : padding);
      case 'L':
        return pad(Math.floor(timestamp % 1000), 3);
      case 'l':
        return pad(hours12(date), padding === null ? ' ' : padding);
      case 'M':
        return pad(date.getMinutes(), padding);
      case 'm':
        return pad(date.getMonth() + 1, padding);
      case 'n':
        return '\n';
      case 'o':
        return String(date.getDate()) + ordinal(date.getDate());
      case 'P':
        return date.getHours() < 12 ? names.am.toLowerCase() : names.pm.toLowerCase();
      case 'p':
        return date.getHours() < 12 ? names.am.toUpperCase() : names.pm.toUpperCase();
      case 'R':
        return strftime(date, '%H:%M');
      case 'r':
        return strftime(date, '%I:%M:%S %p');
      case 'S':
        return pad(date.getSeconds(), padding);
      case 's':
        return Math.floor(timestamp / 1000);
      case 'T':
        return strftime(date, '%H:%M:%S');
      case 't':
        return '\t';
      case 'U':
        return pad(weekNumber(date, 'sunday'), padding);
      case 'u':
        return date.getDay() === 0 ? 7 : date.getDay();
      case 'v':
        return strftime(date, '%e-%b-%Y');
      case 'W':
        return pad(weekNumber(date, 'monday'), padding);
      case 'w':
        return date.getDay();
      case 'Y':
        return date.getFullYear();
      case 'y':
        var y = String(date.getFullYear());return y.slice(y.length - 2);
      case 'Z':
        var tzString = date.toString().match(/\((\w+)\)/);return tzString && tzString[1] || '';
      case 'z':
        var off = date.getTimezoneOffset();return (off > 0 ? '-' : '+') + pad(Math.round(Math.abs(off / 60)), 2) + ':' + pad(off % 60, 2);
      default:
        return c;
    }
  });
}

function pad(n, padding, length) {
  if (typeof padding === 'number') {
    length = padding;
    padding = '0';
  }

  if (padding === null) {
    padding = '0';
  }

  length = length || 2;

  var s = String(n);

  if (padding) {
    while (s.length < length) {
      s = padding + s;
    }
  }

  return s;
}

function hours12(date) {
  var hour = date.getHours();

  if (hour === 0) {
    hour = 12;
  } else if (hour > 12) {
    hour -= 12;
  }

  return hour;
}

function ordinal(n) {
  var i = n % 10,
      ii = n % 100;

  if (ii >= 11 && ii <= 13 || i === 0 || i >= 4) {
    return 'th';
  }

  switch (i) {
    case 1:
      return 'st';
    case 2:
      return 'nd';
    case 3:
      return 'rd';
  }
}

function weekNumber(date, firstWeekday) {
  firstWeekday = firstWeekday || 'sunday';

  var wday = date.getDay();

  if (firstWeekday == 'monday') {
    if (wday === 0) {
      // Sunday
      wday = 6;
    } else {
      wday--;
    }
  }

  var firstDayOfYear = new Date(date.getFullYear(), 0, 1),
      yday = (date - firstDayOfYear) / 86400000,
      weekNum = (yday + 7 - wday) / 7;

  return Math.floor(weekNum);
}

module.exports = strftime;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zdHJmdGltZS5qcyJdLCJuYW1lcyI6WyJkYXRlTmFtZXMiLCJyZXF1aXJlIiwic3RyZnRpbWUiLCJkYXRlIiwiZm9ybWF0IiwibmFtZXMiLCJ0aW1lc3RhbXAiLCJnZXRUaW1lIiwicmVwbGFjZSIsIl8iLCJjIiwicGFkZGluZyIsImxlbmd0aCIsImRheXMiLCJnZXREYXkiLCJhYmJyZXZpYXRlZF9kYXlzIiwibW9udGhzIiwiZ2V0TW9udGgiLCJhYmJyZXZpYXRlZF9tb250aHMiLCJwYWQiLCJNYXRoIiwiZmxvb3IiLCJnZXRGdWxsWWVhciIsImdldERhdGUiLCJnZXRIb3VycyIsImhvdXJzMTIiLCJjZWlsIiwiRGF0ZSIsImdldE1pbnV0ZXMiLCJTdHJpbmciLCJvcmRpbmFsIiwiYW0iLCJ0b0xvd2VyQ2FzZSIsInBtIiwidG9VcHBlckNhc2UiLCJnZXRTZWNvbmRzIiwid2Vla051bWJlciIsInkiLCJzbGljZSIsInR6U3RyaW5nIiwidG9TdHJpbmciLCJtYXRjaCIsIm9mZiIsImdldFRpbWV6b25lT2Zmc2V0Iiwicm91bmQiLCJhYnMiLCJuIiwicyIsImhvdXIiLCJpIiwiaWkiLCJmaXJzdFdlZWtkYXkiLCJ3ZGF5IiwiZmlyc3REYXlPZlllYXIiLCJ5ZGF5Iiwid2Vla051bSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQUlBLFlBQVlDLFFBQVEsWUFBUixDQUFoQjs7QUFFQSxTQUFTQyxRQUFULENBQWtCQyxJQUFsQixFQUF3QkMsTUFBeEIsRUFBZ0NDLEtBQWhDLEVBQXVDO0FBQ3JDLE1BQUlDLFlBQVlILEtBQUtJLE9BQUwsRUFBaEI7O0FBRUFGLFVBQVFBLFNBQVNMLFNBQWpCOztBQUVBLFNBQU9JLE9BQU9JLE9BQVAsQ0FBZSxhQUFmLEVBQThCLFVBQVNDLENBQVQsRUFBWUMsQ0FBWixFQUFlO0FBQ2xELFFBQUlDLFVBQVUsSUFBZDs7QUFFQSxRQUFJRCxFQUFFRSxNQUFGLElBQVksQ0FBaEIsRUFBbUI7QUFDakIsY0FBUUYsRUFBRSxDQUFGLENBQVI7QUFDRSxhQUFLLEdBQUw7QUFBVUMsb0JBQVUsRUFBVixDQUFlO0FBQ3pCLGFBQUssR0FBTDtBQUFVQSxvQkFBVSxHQUFWLENBQWU7QUFDekIsYUFBSyxHQUFMO0FBQVVBLG9CQUFVLEdBQVYsQ0FBZTtBQUN6QjtBQUFTLGlCQUFPRixDQUFQLENBSlgsQ0FJcUI7QUFKckI7O0FBT0FDLFVBQUlBLEVBQUUsQ0FBRixDQUFKO0FBQ0Q7O0FBRUQsWUFBUUEsQ0FBUjtBQUNFLFdBQUssR0FBTDtBQUFVLGVBQU9MLE1BQU1RLElBQU4sQ0FBV1YsS0FBS1csTUFBTCxFQUFYLENBQVA7QUFDVixXQUFLLEdBQUw7QUFBVSxlQUFPVCxNQUFNVSxnQkFBTixDQUF1QlosS0FBS1csTUFBTCxFQUF2QixDQUFQO0FBQ1YsV0FBSyxHQUFMO0FBQVUsZUFBT1QsTUFBTVcsTUFBTixDQUFhYixLQUFLYyxRQUFMLEVBQWIsQ0FBUDtBQUNWLFdBQUssR0FBTDtBQUFVLGVBQU9aLE1BQU1hLGtCQUFOLENBQXlCZixLQUFLYyxRQUFMLEVBQXpCLENBQVA7QUFDVixXQUFLLEdBQUw7QUFBVSxlQUFPRSxJQUFJQyxLQUFLQyxLQUFMLENBQVdsQixLQUFLbUIsV0FBTCxLQUFxQixHQUFoQyxDQUFKLEVBQTBDWCxPQUExQyxDQUFQO0FBQ1YsV0FBSyxHQUFMO0FBQVUsZUFBT1QsU0FBU0MsSUFBVCxFQUFlLFVBQWYsQ0FBUDtBQUNWLFdBQUssR0FBTDtBQUFVLGVBQU9nQixJQUFJaEIsS0FBS29CLE9BQUwsRUFBSixFQUFvQlosT0FBcEIsQ0FBUDtBQUNWLFdBQUssR0FBTDtBQUFVLGVBQU9SLEtBQUtvQixPQUFMLEVBQVA7QUFDVixXQUFLLEdBQUw7QUFBVSxlQUFPckIsU0FBU0MsSUFBVCxFQUFlLFVBQWYsQ0FBUDtBQUNWLFdBQUssR0FBTDtBQUFVLGVBQU9nQixJQUFJaEIsS0FBS3FCLFFBQUwsRUFBSixFQUFxQmIsT0FBckIsQ0FBUDtBQUNWLFdBQUssR0FBTDtBQUFVLGVBQU9OLE1BQU1hLGtCQUFOLENBQXlCZixLQUFLYyxRQUFMLEVBQXpCLENBQVA7QUFDVixXQUFLLEdBQUw7QUFBVSxlQUFPRSxJQUFJTSxRQUFRdEIsSUFBUixDQUFKLEVBQW1CUSxPQUFuQixDQUFQO0FBQ1YsV0FBSyxHQUFMO0FBQVUsZUFBT1EsSUFBSUMsS0FBS00sSUFBTCxDQUFVLENBQUN2QixLQUFLSSxPQUFMLEtBQWtCLElBQUlvQixJQUFKLENBQVN4QixLQUFLbUIsV0FBTCxFQUFULEVBQTZCLENBQTdCLEVBQWdDLENBQWhDLENBQUQsQ0FBcUNmLE9BQXJDLEVBQWxCLEtBQXFFLE9BQU8sRUFBUCxHQUFZLEVBQVosR0FBaUIsRUFBdEYsQ0FBVixDQUFKLEVBQTBHLENBQTFHLENBQVA7QUFDVixXQUFLLEdBQUw7QUFBVSxlQUFPWSxJQUFJaEIsS0FBS3FCLFFBQUwsRUFBSixFQUFxQmIsWUFBWSxJQUFaLEdBQW1CLEdBQW5CLEdBQXlCQSxPQUE5QyxDQUFQO0FBQ1YsV0FBSyxHQUFMO0FBQVUsZUFBT1EsSUFBSUMsS0FBS0MsS0FBTCxDQUFXZixZQUFZLElBQXZCLENBQUosRUFBa0MsQ0FBbEMsQ0FBUDtBQUNWLFdBQUssR0FBTDtBQUFVLGVBQU9hLElBQUlNLFFBQVF0QixJQUFSLENBQUosRUFBbUJRLFlBQVksSUFBWixHQUFtQixHQUFuQixHQUF5QkEsT0FBNUMsQ0FBUDtBQUNWLFdBQUssR0FBTDtBQUFVLGVBQU9RLElBQUloQixLQUFLeUIsVUFBTCxFQUFKLEVBQXVCakIsT0FBdkIsQ0FBUDtBQUNWLFdBQUssR0FBTDtBQUFVLGVBQU9RLElBQUloQixLQUFLYyxRQUFMLEtBQWtCLENBQXRCLEVBQXlCTixPQUF6QixDQUFQO0FBQ1YsV0FBSyxHQUFMO0FBQVUsZUFBTyxJQUFQO0FBQ1YsV0FBSyxHQUFMO0FBQVUsZUFBT2tCLE9BQU8xQixLQUFLb0IsT0FBTCxFQUFQLElBQXlCTyxRQUFRM0IsS0FBS29CLE9BQUwsRUFBUixDQUFoQztBQUNWLFdBQUssR0FBTDtBQUFVLGVBQU9wQixLQUFLcUIsUUFBTCxLQUFrQixFQUFsQixHQUF1Qm5CLE1BQU0wQixFQUFOLENBQVNDLFdBQVQsRUFBdkIsR0FBZ0QzQixNQUFNNEIsRUFBTixDQUFTRCxXQUFULEVBQXZEO0FBQ1YsV0FBSyxHQUFMO0FBQVUsZUFBTzdCLEtBQUtxQixRQUFMLEtBQWtCLEVBQWxCLEdBQXVCbkIsTUFBTTBCLEVBQU4sQ0FBU0csV0FBVCxFQUF2QixHQUFnRDdCLE1BQU00QixFQUFOLENBQVNDLFdBQVQsRUFBdkQ7QUFDVixXQUFLLEdBQUw7QUFBVSxlQUFPaEMsU0FBU0MsSUFBVCxFQUFlLE9BQWYsQ0FBUDtBQUNWLFdBQUssR0FBTDtBQUFVLGVBQU9ELFNBQVNDLElBQVQsRUFBZSxhQUFmLENBQVA7QUFDVixXQUFLLEdBQUw7QUFBVSxlQUFPZ0IsSUFBSWhCLEtBQUtnQyxVQUFMLEVBQUosRUFBdUJ4QixPQUF2QixDQUFQO0FBQ1YsV0FBSyxHQUFMO0FBQVUsZUFBT1MsS0FBS0MsS0FBTCxDQUFXZixZQUFZLElBQXZCLENBQVA7QUFDVixXQUFLLEdBQUw7QUFBVSxlQUFPSixTQUFTQyxJQUFULEVBQWUsVUFBZixDQUFQO0FBQ1YsV0FBSyxHQUFMO0FBQVUsZUFBTyxJQUFQO0FBQ1YsV0FBSyxHQUFMO0FBQVUsZUFBT2dCLElBQUlpQixXQUFXakMsSUFBWCxFQUFpQixRQUFqQixDQUFKLEVBQWdDUSxPQUFoQyxDQUFQO0FBQ1YsV0FBSyxHQUFMO0FBQVUsZUFBT1IsS0FBS1csTUFBTCxPQUFrQixDQUFsQixHQUFzQixDQUF0QixHQUEwQlgsS0FBS1csTUFBTCxFQUFqQztBQUNWLFdBQUssR0FBTDtBQUFVLGVBQU9aLFNBQVNDLElBQVQsRUFBZSxVQUFmLENBQVA7QUFDVixXQUFLLEdBQUw7QUFBVSxlQUFPZ0IsSUFBSWlCLFdBQVdqQyxJQUFYLEVBQWlCLFFBQWpCLENBQUosRUFBZ0NRLE9BQWhDLENBQVA7QUFDVixXQUFLLEdBQUw7QUFBVSxlQUFPUixLQUFLVyxNQUFMLEVBQVA7QUFDVixXQUFLLEdBQUw7QUFBVSxlQUFPWCxLQUFLbUIsV0FBTCxFQUFQO0FBQ1YsV0FBSyxHQUFMO0FBQVUsWUFBSWUsSUFBSVIsT0FBTzFCLEtBQUttQixXQUFMLEVBQVAsQ0FBUixDQUFvQyxPQUFPZSxFQUFFQyxLQUFGLENBQVFELEVBQUV6QixNQUFGLEdBQVcsQ0FBbkIsQ0FBUDtBQUM5QyxXQUFLLEdBQUw7QUFBVSxZQUFJMkIsV0FBV3BDLEtBQUtxQyxRQUFMLEdBQWdCQyxLQUFoQixDQUFzQixXQUF0QixDQUFmLENBQW1ELE9BQU9GLFlBQVlBLFNBQVMsQ0FBVCxDQUFaLElBQTJCLEVBQWxDO0FBQzdELFdBQUssR0FBTDtBQUFVLFlBQUlHLE1BQU12QyxLQUFLd0MsaUJBQUwsRUFBVixDQUFvQyxPQUFPLENBQUNELE1BQU0sQ0FBTixHQUFVLEdBQVYsR0FBZ0IsR0FBakIsSUFBd0J2QixJQUFJQyxLQUFLd0IsS0FBTCxDQUFXeEIsS0FBS3lCLEdBQUwsQ0FBU0gsTUFBTSxFQUFmLENBQVgsQ0FBSixFQUFvQyxDQUFwQyxDQUF4QixHQUFpRSxHQUFqRSxHQUF1RXZCLElBQUl1QixNQUFNLEVBQVYsRUFBYyxDQUFkLENBQTlFO0FBQzlDO0FBQVMsZUFBT2hDLENBQVA7QUF0Q1g7QUF3Q0QsR0F0RE0sQ0FBUDtBQXVERDs7QUFFRCxTQUFTUyxHQUFULENBQWEyQixDQUFiLEVBQWdCbkMsT0FBaEIsRUFBeUJDLE1BQXpCLEVBQWlDO0FBQy9CLE1BQUksT0FBT0QsT0FBUCxLQUFtQixRQUF2QixFQUFpQztBQUMvQkMsYUFBU0QsT0FBVDtBQUNBQSxjQUFVLEdBQVY7QUFDRDs7QUFFRCxNQUFJQSxZQUFZLElBQWhCLEVBQXNCO0FBQ3BCQSxjQUFVLEdBQVY7QUFDRDs7QUFFREMsV0FBU0EsVUFBVSxDQUFuQjs7QUFFQSxNQUFJbUMsSUFBSWxCLE9BQU9pQixDQUFQLENBQVI7O0FBRUEsTUFBSW5DLE9BQUosRUFBYTtBQUNYLFdBQU9vQyxFQUFFbkMsTUFBRixHQUFXQSxNQUFsQixFQUEwQjtBQUN4Qm1DLFVBQUlwQyxVQUFVb0MsQ0FBZDtBQUNEO0FBQ0Y7O0FBRUQsU0FBT0EsQ0FBUDtBQUNEOztBQUVELFNBQVN0QixPQUFULENBQWlCdEIsSUFBakIsRUFBdUI7QUFDckIsTUFBSTZDLE9BQU83QyxLQUFLcUIsUUFBTCxFQUFYOztBQUVBLE1BQUl3QixTQUFTLENBQWIsRUFBZ0I7QUFDZEEsV0FBTyxFQUFQO0FBQ0QsR0FGRCxNQUVPLElBQUlBLE9BQU8sRUFBWCxFQUFlO0FBQ3BCQSxZQUFRLEVBQVI7QUFDRDs7QUFFRCxTQUFPQSxJQUFQO0FBQ0Q7O0FBRUQsU0FBU2xCLE9BQVQsQ0FBaUJnQixDQUFqQixFQUFvQjtBQUNsQixNQUFJRyxJQUFJSCxJQUFJLEVBQVo7QUFBQSxNQUFnQkksS0FBS0osSUFBSSxHQUF6Qjs7QUFFQSxNQUFLSSxNQUFNLEVBQU4sSUFBWUEsTUFBTSxFQUFuQixJQUEwQkQsTUFBTSxDQUFoQyxJQUFxQ0EsS0FBSyxDQUE5QyxFQUFpRDtBQUMvQyxXQUFPLElBQVA7QUFDRDs7QUFFRCxVQUFRQSxDQUFSO0FBQ0UsU0FBSyxDQUFMO0FBQVEsYUFBTyxJQUFQO0FBQ1IsU0FBSyxDQUFMO0FBQVEsYUFBTyxJQUFQO0FBQ1IsU0FBSyxDQUFMO0FBQVEsYUFBTyxJQUFQO0FBSFY7QUFLRDs7QUFFRCxTQUFTYixVQUFULENBQW9CakMsSUFBcEIsRUFBMEJnRCxZQUExQixFQUF3QztBQUN0Q0EsaUJBQWVBLGdCQUFnQixRQUEvQjs7QUFFQSxNQUFJQyxPQUFPakQsS0FBS1csTUFBTCxFQUFYOztBQUVBLE1BQUlxQyxnQkFBZ0IsUUFBcEIsRUFBOEI7QUFDNUIsUUFBSUMsU0FBUyxDQUFiLEVBQWdCO0FBQUU7QUFDaEJBLGFBQU8sQ0FBUDtBQUNELEtBRkQsTUFFTztBQUNMQTtBQUNEO0FBQ0Y7O0FBRUQsTUFDRUMsaUJBQWlCLElBQUkxQixJQUFKLENBQVN4QixLQUFLbUIsV0FBTCxFQUFULEVBQTZCLENBQTdCLEVBQWdDLENBQWhDLENBRG5CO0FBQUEsTUFFRWdDLE9BQU8sQ0FBQ25ELE9BQU9rRCxjQUFSLElBQTBCLFFBRm5DO0FBQUEsTUFHRUUsVUFBVSxDQUFDRCxPQUFPLENBQVAsR0FBV0YsSUFBWixJQUFvQixDQUhoQzs7QUFLQSxTQUFPaEMsS0FBS0MsS0FBTCxDQUFXa0MsT0FBWCxDQUFQO0FBQ0Q7O0FBRURDLE9BQU9DLE9BQVAsR0FBaUJ2RCxRQUFqQiIsImZpbGUiOiJzdHJmdGltZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciBkYXRlTmFtZXMgPSByZXF1aXJlKCdkYXRlLW5hbWVzJyk7XHJcblxyXG5mdW5jdGlvbiBzdHJmdGltZShkYXRlLCBmb3JtYXQsIG5hbWVzKSB7XHJcbiAgdmFyIHRpbWVzdGFtcCA9IGRhdGUuZ2V0VGltZSgpO1xyXG5cclxuICBuYW1lcyA9IG5hbWVzIHx8IGRhdGVOYW1lcztcclxuXHJcbiAgcmV0dXJuIGZvcm1hdC5yZXBsYWNlKC8lKFstXzBdPy4pL2csIGZ1bmN0aW9uKF8sIGMpIHtcclxuICAgIHZhciBwYWRkaW5nID0gbnVsbDtcclxuXHJcbiAgICBpZiAoYy5sZW5ndGggPT0gMikge1xyXG4gICAgICBzd2l0Y2ggKGNbMF0pIHtcclxuICAgICAgICBjYXNlICctJzogcGFkZGluZyA9ICcnOyAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnXyc6IHBhZGRpbmcgPSAnICc7IGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJzAnOiBwYWRkaW5nID0gJzAnOyBicmVhaztcclxuICAgICAgICBkZWZhdWx0OiByZXR1cm4gXzsgLy8gc2hvdWxkIG5ldmVyIHJlYWNoIHRoaXMgb25lXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGMgPSBjWzFdO1xyXG4gICAgfVxyXG5cclxuICAgIHN3aXRjaCAoYykge1xyXG4gICAgICBjYXNlICdBJzogcmV0dXJuIG5hbWVzLmRheXNbZGF0ZS5nZXREYXkoKV07XHJcbiAgICAgIGNhc2UgJ2EnOiByZXR1cm4gbmFtZXMuYWJicmV2aWF0ZWRfZGF5c1tkYXRlLmdldERheSgpXTtcclxuICAgICAgY2FzZSAnQic6IHJldHVybiBuYW1lcy5tb250aHNbZGF0ZS5nZXRNb250aCgpXTtcclxuICAgICAgY2FzZSAnYic6IHJldHVybiBuYW1lcy5hYmJyZXZpYXRlZF9tb250aHNbZGF0ZS5nZXRNb250aCgpXTtcclxuICAgICAgY2FzZSAnQyc6IHJldHVybiBwYWQoTWF0aC5mbG9vcihkYXRlLmdldEZ1bGxZZWFyKCkgLyAxMDApLCBwYWRkaW5nKTtcclxuICAgICAgY2FzZSAnRCc6IHJldHVybiBzdHJmdGltZShkYXRlLCAnJW0vJWQvJXknKTtcclxuICAgICAgY2FzZSAnZCc6IHJldHVybiBwYWQoZGF0ZS5nZXREYXRlKCksIHBhZGRpbmcpO1xyXG4gICAgICBjYXNlICdlJzogcmV0dXJuIGRhdGUuZ2V0RGF0ZSgpO1xyXG4gICAgICBjYXNlICdGJzogcmV0dXJuIHN0cmZ0aW1lKGRhdGUsICclWS0lbS0lZCcpO1xyXG4gICAgICBjYXNlICdIJzogcmV0dXJuIHBhZChkYXRlLmdldEhvdXJzKCksIHBhZGRpbmcpO1xyXG4gICAgICBjYXNlICdoJzogcmV0dXJuIG5hbWVzLmFiYnJldmlhdGVkX21vbnRoc1tkYXRlLmdldE1vbnRoKCldO1xyXG4gICAgICBjYXNlICdJJzogcmV0dXJuIHBhZChob3VyczEyKGRhdGUpLCBwYWRkaW5nKTtcclxuICAgICAgY2FzZSAnaic6IHJldHVybiBwYWQoTWF0aC5jZWlsKChkYXRlLmdldFRpbWUoKSAtIChuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIDAsIDEpKS5nZXRUaW1lKCkpIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKSwgMyk7XHJcbiAgICAgIGNhc2UgJ2snOiByZXR1cm4gcGFkKGRhdGUuZ2V0SG91cnMoKSwgcGFkZGluZyA9PT0gbnVsbCA/ICcgJyA6IHBhZGRpbmcpO1xyXG4gICAgICBjYXNlICdMJzogcmV0dXJuIHBhZChNYXRoLmZsb29yKHRpbWVzdGFtcCAlIDEwMDApLCAzKTtcclxuICAgICAgY2FzZSAnbCc6IHJldHVybiBwYWQoaG91cnMxMihkYXRlKSwgcGFkZGluZyA9PT0gbnVsbCA/ICcgJyA6IHBhZGRpbmcpO1xyXG4gICAgICBjYXNlICdNJzogcmV0dXJuIHBhZChkYXRlLmdldE1pbnV0ZXMoKSwgcGFkZGluZyk7XHJcbiAgICAgIGNhc2UgJ20nOiByZXR1cm4gcGFkKGRhdGUuZ2V0TW9udGgoKSArIDEsIHBhZGRpbmcpO1xyXG4gICAgICBjYXNlICduJzogcmV0dXJuICdcXG4nO1xyXG4gICAgICBjYXNlICdvJzogcmV0dXJuIFN0cmluZyhkYXRlLmdldERhdGUoKSkgKyBvcmRpbmFsKGRhdGUuZ2V0RGF0ZSgpKTtcclxuICAgICAgY2FzZSAnUCc6IHJldHVybiBkYXRlLmdldEhvdXJzKCkgPCAxMiA/IG5hbWVzLmFtLnRvTG93ZXJDYXNlKCkgOiBuYW1lcy5wbS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICBjYXNlICdwJzogcmV0dXJuIGRhdGUuZ2V0SG91cnMoKSA8IDEyID8gbmFtZXMuYW0udG9VcHBlckNhc2UoKSA6IG5hbWVzLnBtLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgIGNhc2UgJ1InOiByZXR1cm4gc3RyZnRpbWUoZGF0ZSwgJyVIOiVNJyk7XHJcbiAgICAgIGNhc2UgJ3InOiByZXR1cm4gc3RyZnRpbWUoZGF0ZSwgJyVJOiVNOiVTICVwJyk7XHJcbiAgICAgIGNhc2UgJ1MnOiByZXR1cm4gcGFkKGRhdGUuZ2V0U2Vjb25kcygpLCBwYWRkaW5nKTtcclxuICAgICAgY2FzZSAncyc6IHJldHVybiBNYXRoLmZsb29yKHRpbWVzdGFtcCAvIDEwMDApO1xyXG4gICAgICBjYXNlICdUJzogcmV0dXJuIHN0cmZ0aW1lKGRhdGUsICclSDolTTolUycpO1xyXG4gICAgICBjYXNlICd0JzogcmV0dXJuICdcXHQnO1xyXG4gICAgICBjYXNlICdVJzogcmV0dXJuIHBhZCh3ZWVrTnVtYmVyKGRhdGUsICdzdW5kYXknKSwgcGFkZGluZyk7XHJcbiAgICAgIGNhc2UgJ3UnOiByZXR1cm4gZGF0ZS5nZXREYXkoKSA9PT0gMCA/IDcgOiBkYXRlLmdldERheSgpO1xyXG4gICAgICBjYXNlICd2JzogcmV0dXJuIHN0cmZ0aW1lKGRhdGUsICclZS0lYi0lWScpO1xyXG4gICAgICBjYXNlICdXJzogcmV0dXJuIHBhZCh3ZWVrTnVtYmVyKGRhdGUsICdtb25kYXknKSwgcGFkZGluZyk7XHJcbiAgICAgIGNhc2UgJ3cnOiByZXR1cm4gZGF0ZS5nZXREYXkoKTtcclxuICAgICAgY2FzZSAnWSc6IHJldHVybiBkYXRlLmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgIGNhc2UgJ3knOiB2YXIgeSA9IFN0cmluZyhkYXRlLmdldEZ1bGxZZWFyKCkpOyByZXR1cm4geS5zbGljZSh5Lmxlbmd0aCAtIDIpO1xyXG4gICAgICBjYXNlICdaJzogdmFyIHR6U3RyaW5nID0gZGF0ZS50b1N0cmluZygpLm1hdGNoKC9cXCgoXFx3KylcXCkvKTsgcmV0dXJuIHR6U3RyaW5nICYmIHR6U3RyaW5nWzFdIHx8ICcnO1xyXG4gICAgICBjYXNlICd6JzogdmFyIG9mZiA9IGRhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKTsgcmV0dXJuIChvZmYgPiAwID8gJy0nIDogJysnKSArIHBhZChNYXRoLnJvdW5kKE1hdGguYWJzKG9mZiAvIDYwKSksIDIpICsgJzonICsgcGFkKG9mZiAlIDYwLCAyKTtcclxuICAgICAgZGVmYXVsdDogcmV0dXJuIGM7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBhZChuLCBwYWRkaW5nLCBsZW5ndGgpIHtcclxuICBpZiAodHlwZW9mIHBhZGRpbmcgPT09ICdudW1iZXInKSB7XHJcbiAgICBsZW5ndGggPSBwYWRkaW5nO1xyXG4gICAgcGFkZGluZyA9ICcwJztcclxuICB9XHJcblxyXG4gIGlmIChwYWRkaW5nID09PSBudWxsKSB7XHJcbiAgICBwYWRkaW5nID0gJzAnO1xyXG4gIH1cclxuXHJcbiAgbGVuZ3RoID0gbGVuZ3RoIHx8IDI7XHJcblxyXG4gIHZhciBzID0gU3RyaW5nKG4pO1xyXG5cclxuICBpZiAocGFkZGluZykge1xyXG4gICAgd2hpbGUgKHMubGVuZ3RoIDwgbGVuZ3RoKSB7XHJcbiAgICAgIHMgPSBwYWRkaW5nICsgcztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBzO1xyXG59XHJcblxyXG5mdW5jdGlvbiBob3VyczEyKGRhdGUpIHtcclxuICB2YXIgaG91ciA9IGRhdGUuZ2V0SG91cnMoKTtcclxuXHJcbiAgaWYgKGhvdXIgPT09IDApIHtcclxuICAgIGhvdXIgPSAxMjtcclxuICB9IGVsc2UgaWYgKGhvdXIgPiAxMikge1xyXG4gICAgaG91ciAtPSAxMjtcclxuICB9XHJcblxyXG4gIHJldHVybiBob3VyO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvcmRpbmFsKG4pIHtcclxuICB2YXIgaSA9IG4gJSAxMCwgaWkgPSBuICUgMTAwO1xyXG5cclxuICBpZiAoKGlpID49IDExICYmIGlpIDw9IDEzKSB8fCBpID09PSAwIHx8IGkgPj0gNCkge1xyXG4gICAgcmV0dXJuICd0aCc7XHJcbiAgfVxyXG5cclxuICBzd2l0Y2ggKGkpIHtcclxuICAgIGNhc2UgMTogcmV0dXJuICdzdCc7XHJcbiAgICBjYXNlIDI6IHJldHVybiAnbmQnO1xyXG4gICAgY2FzZSAzOiByZXR1cm4gJ3JkJztcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHdlZWtOdW1iZXIoZGF0ZSwgZmlyc3RXZWVrZGF5KSB7XHJcbiAgZmlyc3RXZWVrZGF5ID0gZmlyc3RXZWVrZGF5IHx8ICdzdW5kYXknO1xyXG5cclxuICB2YXIgd2RheSA9IGRhdGUuZ2V0RGF5KCk7XHJcblxyXG4gIGlmIChmaXJzdFdlZWtkYXkgPT0gJ21vbmRheScpIHtcclxuICAgIGlmICh3ZGF5ID09PSAwKSB7IC8vIFN1bmRheVxyXG4gICAgICB3ZGF5ID0gNjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdkYXktLTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHZhclxyXG4gICAgZmlyc3REYXlPZlllYXIgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIDAsIDEpLFxyXG4gICAgeWRheSA9IChkYXRlIC0gZmlyc3REYXlPZlllYXIpIC8gODY0MDAwMDAsXHJcbiAgICB3ZWVrTnVtID0gKHlkYXkgKyA3IC0gd2RheSkgLyA3O1xyXG5cclxuICByZXR1cm4gTWF0aC5mbG9vcih3ZWVrTnVtKTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBzdHJmdGltZTtcclxuIl19